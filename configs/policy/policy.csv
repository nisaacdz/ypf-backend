# Casbin Policy Rules
# Defines who can do what.
# Format: p, role, resource_path, action, effect

# ---------------------------------------------------------------------------
# GLOBAL ROLES (President has universal access)
# ---------------------------------------------------------------------------
p, role_president, /*, *, allow

# ---------------------------------------------------------------------------
# CHAPTER-SCOPED EXECUTIVE ROLES
# ---------------------------------------------------------------------------

# -- role_chapter_head: Manages all aspects of a specific chapter --
p, role_chapter_head, /chapters/:chapterId, view:details, allow
p, role_chapter_head, /chapters/:chapterId, edit:details, allow
p, role_chapter_head, /chapters/:chapterId/*, *, allow # Full control over sub-resources (members, projects, etc.)

# -- role_organizer: Manages projects and events within a chapter --
p, role_organizer, /chapters/:chapterId/projects, create, allow
p, role_organizer, /chapters/:chapterId/projects/:id, *, allow # Full control over a specific project
p, role_organizer, /chapters/:chapterId/events, create, allow
p, role_organizer, /chapters/:chapterId/events/:id, *, allow # Full control over a specific event
p, role_organizer, /chapters/:chapterId/projects/:id/impact-reports, create, allow

# -- role_secretary: Manages chapter records and communications --
p, role_secretary, /chapters/:chapterId/meetings, *, allow
p, role_secretary, /chapters/:chapterId/announcements, *, allow
p, role_secretary, /chapters/:chapterId/members, view:list, allow

# -- role_financial_secretary: Manages chapter finances --
p, role_financial_secretary, /chapters/:chapterId/donations, view:*, allow
p, role_financial_secretary, /chapters/:chapterId/dues, *, allow
p, role_financial_secretary, /chapters/:chapterId/expenditures, *, allow
p, role_financial_secretary, /chapters/:chapterId/reports/financial, generate, allow

# ---------------------------------------------------------------------------
# COMMITTEE-SCOPED ROLES
# ---------------------------------------------------------------------------
p, role_committee_head, /committees/:committeeId, *, allow
p, role_committee_head, /committees/:committeeId/*, *, allow

# ---------------------------------------------------------------------------
# IMPLICIT ROLES (Assigned by middleware based on context)
# ---------------------------------------------------------------------------

# -- A member of a specific chapter can view most things inside it --
p, role_chapter_member, /chapters/:chapterId/projects, view:list, allow
p, role_chapter_member, /chapters/:chapterId/projects/:id, view:details, allow
p, role_chapter_member, /chapters/:chapterId/events, view:list, allow
p, role_chapter_member, /chapters/:chapterId/events/:id, view:details, allow
p, role_chapter_member, /chapters/:chapterId/members, view:list, allow
p, role_chapter_member, /chapters/:chapterId/announcements, view:list, allow

# -- Any authenticated user can see high-level public information --
p, role_authenticated_user, /chapters, view:list, allow
p, role_authenticated_user, /chapters/:id, view:details, allow
p, role_authenticated_user, /committees, view:list, allow
p, role_authenticated_user, /committees/:id, view:details, allow
p, role_authenticated_user, /constituents/:id, view:own_profile, allow # App logic must verify this
p, role_authenticated_user, /constituents/:id, edit:own_profile, allow # App logic must verify this