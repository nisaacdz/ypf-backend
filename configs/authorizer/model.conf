[request_definition]
# sub: The full AuthenticatedUser object.
# obj: The URL path (e.g., /events/some-uuid).
# act: The HTTP method (e.g., GET, POST, DELETE).
r = sub, obj, act

[policy_definition]
# sub: The role OR membership type the policy applies to.
p = sub, obj, act, eft

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
# The core logic. A request is allowed if:
# 1. (The user has the required role OR the user has the required membership type)
# 2. AND the requested path matches the policy's path pattern.
# 3. AND the request method matches the policy's action pattern.
m = (hasRole(r.sub, p.sub) || hasMembership(r.sub, p.sub)) && keyMatch2(r.obj, p.obj) && keyMatch(r.act, p.act)